{"version":3,"file":"0.6a94cd4bb7cee0ece360.hot-update.js","sources":["webpack:///./src/layouts/LoggedInLayout/CreateCardLayout/components/DesignTool/Components/Card/MainCanvas/UText.tsx"],"sourcesContent":["import React, { useState, useRef } from 'react'\r\nimport { Text } from 'react-konva'\r\nimport { Html } from 'react-konva-utils'\r\nimport { useImmerState } from '@shrugsy/use-immer-state';\r\n\r\nconst initial_textArea = {\r\n    textEditVisible: false,\r\n    textX: 0,\r\n    textY: 0\r\n}\r\n\r\nconst UText = ({ textProps, onChange, onSelect, handleTextEdit, isSelected, $tr }) => {\r\n    const textNode = useRef(null)\r\n    const [newTextObj, setNewTextObj] = useImmerState(initial_textArea)\r\n    const textAreaRef = useRef(null)\r\n\r\n    const handleSelectText = () => {\r\n        setNewTextObj(initial_textArea)\r\n        onSelect()\r\n    }\r\n\r\n    const handleTextDblClick = e => {\r\n        // textNode.current.hide()\r\n        // $tr.current.hide()\r\n        const absPos = e.target.getAbsolutePosition();\r\n        setNewTextObj(prev => {\r\n            prev.textEditVisible = true;\r\n            prev.textX = absPos.x;\r\n            prev.textY = absPos.y;\r\n        })\r\n    };\r\n\r\n    const handleTextChange = (e) => {\r\n        handleTextEdit(e.target.value)\r\n    }\r\n\r\n    const handleTextareaKeyDown = (e) => {\r\n        if (e.keyCode === \"Escape\") {\r\n            setNewTextObj(prev => {\r\n                prev.textEditVisible = false;\r\n            })\r\n            // textNode.current.show()\r\n            // $tr.current.show()\r\n            // $tr.current.forceUpdate()\r\n        }\r\n    }\r\n\r\n    const { fill: color, fontFamily, fontSize } = textProps\r\n\r\n\r\n    return (\r\n        <>\r\n            <Text\r\n                ref={textNode}\r\n                onClick={handleSelectText}\r\n                onTap={handleSelectText}\r\n                onDblClick={(e) => handleTextDblClick(e)}\r\n                onDblTap={(e) => handleTextDblClick(e)}\r\n                onTransform={(e) => {\r\n                    let SX = textNode.current.scaleX();\r\n                    let W = textNode.current.width();\r\n                    textAreaRef.current.style.transform = `rotateZ(${e.target.attrs?.rotation}deg)`\r\n                    textAreaRef.current.style.transformOrigin = \"50% 50%\"\r\n                    textNode.current.setAttrs({\r\n                        // ...textNode.current.getAttrs(),\r\n                        // fontSize: isWordWrapping ? textNode.current.fontSize() : textNode.current.fontSize() * textNode.current.scaleX(),\r\n                        width: W * SX,\r\n                        scaleX: 1,\r\n                        scaleY: 1,\r\n                    });\r\n                }}\r\n                opacity={!(isSelected && newTextObj.textEditVisible) ? textProps?.opacity : 0}\r\n                // style={{\r\n                //     display:  ? \"none\" : \"block\",\r\n                // }}\r\n                // onTransformEnd={onChange}\r\n                onDragEnd={onChange}\r\n                {...textProps}\r\n                draggable={!(isSelected && newTextObj.textEditVisible)}\r\n\r\n            />\r\n            <Html>\r\n                <textarea\r\n                    onInput={(e: any) => {\r\n                        e.target.style.height = \"5px\"\r\n                        e.target.style.height = (e.target.scrollHeight) + \"px\";\r\n                    }}\r\n                    ref={textAreaRef}\r\n                    value={textProps.text}\r\n                    style={{\r\n                        display: isSelected && newTextObj.textEditVisible ? \"block\" : \"none\",\r\n                        position: \"absolute\",\r\n                        top: newTextObj.textY + \"px\",\r\n                        left: newTextObj.textX + \"px\",\r\n                        outline: \"none\",\r\n                        // border: \"2px solid blue\",\r\n                        // opacity: 0,\r\n                        resize: 'none',\r\n                        overflow: 'hidden',\r\n                        minHeight: '50px',\r\n                        color, fontFamily, fontSize,\r\n                        width: textNode.current?.getClientRect()?.width,\r\n                        height: textNode.current?.getClientRect()?.height,\r\n                        lineHeight: 1,\r\n                        background: 'transparent',\r\n                        // transform: `rotateZ(${textNode.current?.attrs?.rotation}deg)`,\r\n                        // transformOrigin: 'top left'\r\n                    }}\r\n                    onChange={handleTextChange}\r\n                    onKeyDown={handleTextareaKeyDown}\r\n                />\r\n            </Html>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default UText\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAHA;AACA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAGA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AAEA;AACA;AACA;AAvBA;AAwBA;AAxBA;AA0BA;AA1BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA6BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAlBA;AAmBA;AACA;AA3BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgCA;AACA;AACA;;;;A","sourceRoot":""}